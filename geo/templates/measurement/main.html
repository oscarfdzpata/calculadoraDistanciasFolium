{% extends 'measurement/base.html' %}
{% load crispy_forms_tags %}

{% block title %}
calculate distance
{% endblock title %}

{% block content %}
<!-- Button trigger modal -->
<!--
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
    Launch demo modal
  </button>
-->
  
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Destino calculado</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          La distancia a tu destino entre <span class="badge badge-secondary">{{ location|upper }} </span> y <span class="badge badge-secondary"> {{ destination|upper }}  </span> es {{ distance }} km
        </div>
        <div class="modal-footer">
            <!--
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
            -->
        </div>
      </div>
    </div>
  </div>
{% if distance is not None %}
<div class="alert alert-success" role="alert">
    La distancia entre <span class="badge badge-secondary">{{ location|upper }} </span> y <span class="badge badge-secondary"> {{ destination|upper }}  </span> es: {{ distance }} km
</div>    
{% endif %}

  <div class="row">
    <div class="col">
          <hr>
          <form action="" id="form" method="POST" autocomplete="off">

              {% csrf_token %}
              {{ form|crispy }}
              <button id="submit_form" type="submit" class="btn btn-outline-secondary btn-block">Calcular</button>
          </form>
          <br>
    </div>
  </div>

  <div class="row">
    <div class="col">
          <div id="mapa" style="position: relative; width: 100%; height: 100%;" >
            <div style="position: relative; left: 1px; top: 25px; width: 100%; height: 100%"> 
              {{ map|safe }}
              <br>
              <br>
              <br>
            </div>

            <div id="cargando-mapa" style="position: absolute; left: 50%; top: 100px; z-index: 3;">  
            
            </div>

            
          </div>
    </div>
  </div>



  <!--
  <div class="alert alert-primary" role="alert">
    A simple primary alertâ€”check it out!
  </div>
-->


<br>
<br>
<br>


{% endblock content  %}

{% block scripts %}
<script>
    {% if request.POST and distance is not None %}
    $(window).on('load', function(){
        $('#exampleModal').modal('show');
    }
    );
    {% endif %}
    
</script>

<script>
    var form = document.getElementById("form");
    var status = document.getElementById("submit_form").textContent;
    var contenido="";
    contenido="Enviando datos...<div class='spinner-grow text-alert ml-4 spinner-border-sm'  role='status'> <span class='sr-only'></span></div>";
    var contenido2="<h4>Calculando...</h4> <div class='spinner-border text-dark ml-4 '  role='status' style='z-index: 10; width: 3rem; height: 3rem;'> <span class='sr-only'></span></div>";
    //alert(status);
   
    //document.getElementById("cargando-mapa").innerHTML+=contenido2;
    //document.getElementById("submit_form").textContent=contenido;
    

    function handleSubmit(event) {
      var elem = document.getElementById("submit_form");
      
      document.getElementById("submit_form").innerHTML=contenido;
      elem.setAttribute("disabled", "");
      //$("#submit_form").html('<span  class="spinner-border spinner-border-sm mr-2 mt-1 float-right ml-2" aria-hidden="true" role="status"></span> Enviando ID...');
      
    document.getElementById("cargando-mapa").innerHTML+=contenido2;

    }

    form.addEventListener("submit", handleSubmit)

</script>


{% endblock scripts %}